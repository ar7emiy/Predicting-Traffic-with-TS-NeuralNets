<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head></head><body>















    




    
    
    
    


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1><strong>IMPORTANT</strong><a rel="noopener" class="anchor-link" href="#IMPORTANT">&#182;</a></h1><ol>
<li>The first cell only needs to be executed to import the dataset from Kaggle.</li>
<li>The best model is a bidirectional lstm model with tuned dropout, recurrent units, and stacked recurrent layers, and L2 regularization. IT IS THE FIRST MODEL AFTER THE WINDOWGENERATOR CLASS. The full story of baseline to 1D covnet +GRU model can be found right after</li>
</ol>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[40]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#first cell start</span>





<span class="c1"># IMPORTANT: RUN THIS CELL IN ORDER TO IMPORT YOUR KAGGLE DATA SOURCES</span>
<span class="c1"># TO THE CORRECT LOCATION (/kaggle/input) IN YOUR NOTEBOOK,</span>
<span class="c1"># THEN FEEL FREE TO DELETE THIS CELL.</span>
<span class="c1"># NOTE: THIS NOTEBOOK ENVIRONMENT DIFFERS FROM KAGGLE&#39;S PYTHON</span>
<span class="c1"># ENVIRONMENT SO THERE MAY BE MISSING LIBRARIES USED BY YOUR</span>
<span class="c1"># NOTEBOOK.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">NamedTemporaryFile</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">unquote</span><span class="p">,</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">HTTPError</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">40960</span>
<span class="n">DATA_SOURCE_MAPPING</span> <span class="o">=</span> <span class="s1">&#39;csc-578-final-project-spring-2024:https%3A</span><span class="si">%2F%2F</span><span class="s1">storage.googleapis.com</span><span class="si">%2F</span><span class="s1">kaggle-competitions-data</span><span class="si">%2F</span><span class="s1">kaggle-v2</span><span class="si">%2F</span><span class="s1">80654</span><span class="si">%2F</span><span class="s1">8659197</span><span class="si">%2F</span><span class="s1">bundle</span><span class="si">%2F</span><span class="s1">archive.zip</span><span class="si">%3F</span><span class="s1">X-Goog-Algorithm%3DGOOG4-RSA-SHA256</span><span class="si">%26X</span><span class="s1">-Goog-Credential%3Dgcp-kaggle-com%2540kaggle-161607.iam.gserviceaccount.com</span><span class="si">%252F</span><span class="s1">20240612</span><span class="si">%252F</span><span class="s1">auto</span><span class="si">%252F</span><span class="s1">storage</span><span class="si">%252F</span><span class="s1">goog4_request</span><span class="si">%26X</span><span class="s1">-Goog-Date%3D20240612T200950Z</span><span class="si">%26X</span><span class="s1">-Goog-Expires%3D259200</span><span class="si">%26X</span><span class="s1">-Goog-SignedHeaders%3Dhost</span><span class="si">%26X</span><span class="s1">-Goog-Signature%3D1ad94aa0fd7e0911e973afaee326e26fe89adf1fa011b328f8b5a882c22e4898616cd66b3654425e683e82f3b6188645f315e0513609f81fc7f7722d0de3eeb8e4fc0b4fada8ff69e9026097d1d8a20219db36d96cb33eafdb1011fd157a0d13bd227d17fe067aefe4bea6be44fee31649b4cff575eaef62e67a034f3ef02b0de39156a57c85d9de7aeaeaa7d088d2a680b4961df94471fae01bd915655000fbf9f3415b0fb04c2428da094b1767d0402892131c5611ec0ea45debc2eb0e96e69baf88e3485149878e9c795df3900e2745df6ae048335ef78750bcac81d90ab288de69b04f397748856b6676812dc68e4714ad65881b5be195ea6a1fe210b649&#39;</span>

<span class="n">KAGGLE_INPUT_PATH</span><span class="o">=</span><span class="s1">&#39;/kaggle/input&#39;</span>
<span class="n">KAGGLE_WORKING_PATH</span><span class="o">=</span><span class="s1">&#39;/kaggle/working&#39;</span>
<span class="n">KAGGLE_SYMLINK</span><span class="o">=</span><span class="s1">&#39;kaggle&#39;</span>

<span class="o">!</span>umount<span class="w"> </span>/kaggle/input/<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>/dev/null
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;/kaggle/input&#39;</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">KAGGLE_INPUT_PATH</span><span class="p">,</span> <span class="mo">0o777</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">KAGGLE_WORKING_PATH</span><span class="p">,</span> <span class="mo">0o777</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
  <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">KAGGLE_INPUT_PATH</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">),</span> <span class="n">target_is_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
  <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">KAGGLE_WORKING_PATH</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s1">&#39;working&#39;</span><span class="p">),</span> <span class="n">target_is_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
  <span class="k">pass</span>

<span class="k">for</span> <span class="n">data_source_mapping</span> <span class="ow">in</span> <span class="n">DATA_SOURCE_MAPPING</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
    <span class="n">directory</span><span class="p">,</span> <span class="n">download_url_encoded</span> <span class="o">=</span> <span class="n">data_source_mapping</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">download_url</span> <span class="o">=</span> <span class="n">unquote</span><span class="p">(</span><span class="n">download_url_encoded</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
    <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">KAGGLE_INPUT_PATH</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileres</span><span class="p">,</span> <span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">tfile</span><span class="p">:</span>
            <span class="n">total_length</span> <span class="o">=</span> <span class="n">fileres</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-length&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Downloading </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">total_length</span><span class="si">}</span><span class="s1"> bytes compressed&#39;</span><span class="p">)</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fileres</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">CHUNK_SIZE</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dl</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">tfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">done</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">50</span> <span class="o">*</span> <span class="n">dl</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_length</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">[</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">done</span><span class="si">}{</span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">50</span><span class="o">-</span><span class="n">done</span><span class="p">)</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">dl</span><span class="si">}</span><span class="s2"> bytes downloaded&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">fileres</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">CHUNK_SIZE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.zip&#39;</span><span class="p">):</span>
              <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">tfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">zfile</span><span class="p">:</span>
                <span class="n">zfile</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">tarfile</span><span class="p">:</span>
                <span class="n">tarfile</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Downloaded and uncompressed: </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to load (likely expired) </span><span class="si">{</span><span class="n">download_url</span><span class="si">}</span><span class="s1"> to path </span><span class="si">{</span><span class="n">destination_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to load </span><span class="si">{</span><span class="n">download_url</span><span class="si">}</span><span class="s1"> to path </span><span class="si">{</span><span class="n">destination_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">continue</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data source import complete.&#39;</span><span class="p">)</span>




<span class="c1">#first cell end</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Downloading csc-578-final-project-spring-2024, 380592 bytes compressed
[==================================================] 380592 bytes downloaded
Downloaded and uncompressed: csc-578-final-project-spring-2024
Data source import complete.
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1>Traffic Prediction with Baseline and RNN LSTM  model<a rel="noopener" class="anchor-link" href="#Traffic-Prediction-with-Baseline-and-RNN-LSTM--model">&#182;</a></h1>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[41]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">IPython</span>
<span class="kn">import</span> <span class="nn">IPython.display</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">ReduceLROnPlateau</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.regularizers</span> <span class="kn">import</span> <span class="n">l2</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Bidirectional</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv1D</span><span class="p">,</span> <span class="n">MaxPooling1D</span><span class="p">,</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Reshape</span>




<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[42]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/kaggle/input/csc-578-final-project-spring-2024/Metro_Interstate_reduced.csv&#39;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1>EDA<a rel="noopener" class="anchor-link" href="#EDA">&#182;</a></h1>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[43]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[43]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult">

  <div class="colab-df-container">
    <div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>holiday</th>
      <th>temp</th>
      <th>rain_1h</th>
      <th>snow_1h</th>
      <th>clouds_all</th>
      <th>weather_main</th>
      <th>weather_description</th>
      <th>date_time</th>
      <th>traffic_volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>288.28</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>40</td>
      <td>Clouds</td>
      <td>scattered clouds</td>
      <td>2012-10-02 09:00:00</td>
      <td>5545</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>289.36</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>75</td>
      <td>Clouds</td>
      <td>broken clouds</td>
      <td>2012-10-02 10:00:00</td>
      <td>4516</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>289.58</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90</td>
      <td>Clouds</td>
      <td>overcast clouds</td>
      <td>2012-10-02 11:00:00</td>
      <td>4767</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>290.13</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90</td>
      <td>Clouds</td>
      <td>overcast clouds</td>
      <td>2012-10-02 12:00:00</td>
      <td>5026</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>291.14</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>75</td>
      <td>Clouds</td>
      <td>broken clouds</td>
      <td>2012-10-02 13:00:00</td>
      <td>4918</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    

  
    
  
    

  

    
  </div>


<div>
  


    
        
    

  



  
</div>

    </div>
  </div>

</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[44]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Summary stats</span>
<span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[44]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult">

  <div class="colab-df-container">
    <div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temp</th>
      <th>rain_1h</th>
      <th>snow_1h</th>
      <th>clouds_all</th>
      <th>traffic_volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>281.316763</td>
      <td>0.318632</td>
      <td>0.000117</td>
      <td>44.199162</td>
      <td>3290.650474</td>
    </tr>
    <tr>
      <th>std</th>
      <td>13.816618</td>
      <td>48.812640</td>
      <td>0.005676</td>
      <td>38.683447</td>
      <td>1984.772909</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>271.840000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1248.500000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>282.860000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.000000</td>
      <td>3427.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>292.280000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>90.000000</td>
      <td>4952.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>310.070000</td>
      <td>9831.300000</td>
      <td>0.510000</td>
      <td>100.000000</td>
      <td>7280.000000</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    

  
    
  
    

  

    
  </div>


<div>
  


    
        
    

  



  
</div>

    </div>
  </div>

</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[45]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>holiday                40522
temp                       0
rain_1h                    0
snow_1h                    0
clouds_all                 0
weather_main               0
weather_description        0
date_time                  0
traffic_volume             0
dtype: int64
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[46]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Histograms</span>
<span class="n">data</span><span class="p">[[</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;rain_1h&#39;</span><span class="p">,</span> <span class="s1">&#39;snow_1h&#39;</span><span class="p">,</span> <span class="s1">&#39;clouds_all&#39;</span><span class="p">,</span> <span class="s1">&#39;traffic_volume&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Histograms of Numerical Features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Boxplots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;rain_1h&#39;</span><span class="p">,</span> <span class="s1">&#39;snow_1h&#39;</span><span class="p">,</span> <span class="s1">&#39;clouds_all&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Boxplot of </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[47]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Exploring the distribution of the target variable (assuming &#39;traffic_volume&#39; is the target)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of Traffic Volume&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Traffic Volume&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>

<span class="c1"># Creating a boxplot to identify any outliers in traffic volume</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of Traffic Volume&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature vs Traffic Volume&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (Kelvin)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Traffic Volume&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[48]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Investigating extreme values in &#39;rain_1h&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rain 1h - Descriptive Statistics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Plotting the distribution of &#39;rain_1h&#39; to identify outliers</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of Rainfall in 1 Hour&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">non_zero_rain_counts</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of non-zero rainfall entries:&quot;</span><span class="p">,</span> <span class="n">non_zero_rain_counts</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Rain 1h - Descriptive Statistics:
count    40575.000000
mean         0.318632
std         48.812640
min          0.000000
25%          0.000000
50%          0.000000
75%          0.000000
max       9831.300000
Name: rain_1h, dtype: float64
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Number of non-zero rainfall entries: 2054
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[49]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Investigating extreme values in &#39;snow_1h&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Snow 1h - Descriptive Statistics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;snow_1h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Plotting the distribution of &#39;snow_1h&#39; to identify outliers</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;snow_1h&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of Snowfall in 1 Hour&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Counting non-zero snowfall entries</span>
<span class="n">non_zero_snow_counts</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;snow_1h&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of non-zero snowfall entries:&quot;</span><span class="p">,</span> <span class="n">non_zero_snow_counts</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Snow 1h - Descriptive Statistics:
count    40575.000000
mean         0.000117
std          0.005676
min          0.000000
25%          0.000000
50%          0.000000
75%          0.000000
max          0.510000
Name: snow_1h, dtype: float64
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Number of non-zero snowfall entries: 31
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[50]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>

<span class="c1"># Analyzing &#39;weather_main&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;weather_main&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Frequency of Weather Main Categories&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Analyzing &#39;weather_description&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;weather_description&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Frequency of Weather Description Categories&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>  <span class="c1"># Rotate the labels for better readability</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Analyzing &#39;clouds_all&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;clouds_all&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of Cloud Coverage&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cloud Coverage (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1>Cleaning<a rel="noopener" class="anchor-link" href="#Cleaning">&#182;</a></h1>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[51]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Convert &#39;date_time&#39; to datetime format</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[52]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;weather_main&#39;</span><span class="p">,</span> <span class="s1">&#39;weather_description&#39;</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[53]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Added after EDA</span>
<span class="c1"># Drop the &#39;holiday&#39; column</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;holiday&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Replace 0 Kelvin values with the median temperature</span>
<span class="n">median_temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median Temperature: </span><span class="si">{</span><span class="n">median_temp</span><span class="si">}</span><span class="s2"> K&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">median_temp</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#minesotta is cold but not -273 Celcius cold...</span>

<span class="c1"># Verify the changes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Median Temperature: 282.86 K
count    40575.000000
mean       281.386476
std         13.091592
min        243.390000
25%        271.850000
50%        282.860000
75%        292.280000
max        310.070000
Name: temp, dtype: float64
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[54]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create new columns for hour, day, month, and year</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>  <span class="c1"># Monday=0, Sunday=6</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[55]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Sinusoidal encoding for cyclical features</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;sin_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;cos_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;sin_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;cos_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Drop the original &#39;date_time&#39; if no longer needed</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[55]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[56]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">rain_99th_percentile</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;99th Percentile of Rainfall: </span><span class="si">{</span><span class="n">rain_99th_percentile</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>

<span class="c1"># Cap values at the 99th percentile</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">upper</span><span class="o">=</span><span class="n">rain_99th_percentile</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>99th Percentile of Rainfall: 1.78 mm
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>after capping the rain variable we still see there is a significant skew towards zero and rain itself is infrequent. It makes conceptual common sense that its that way... On the bright side the outliers (which were likely errors) were handled effectively</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[57]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Visualize the capped &#39;rain_1h&#39; data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of Capped Rainfall in 1 Hour&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histogram of capped &#39;rain_1h&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of Capped Rainfall in 1 Hour&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[58]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">correlation</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The correlation between capped rain and traffic volume is: </span><span class="si">{</span><span class="n">correlation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Visualize the relationship</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Capped Transformed Rainfall vs. Traffic Volume&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rainfall&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Traffic Volume&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>The correlation between capped rain and traffic volume is: -0.0066747092806836005
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>How about rain vs no rain variable</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[59]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Creating a binary rain indicator</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_present&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_1h&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Calculating correlation with traffic volume</span>
<span class="n">correlation_binary_rain</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rain_present&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The correlation between presence of rain and traffic volume is: </span><span class="si">{</span><span class="n">correlation_binary_rain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize the relationship</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rain_present&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Traffic Volume by Rain Presence&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rain Presence (0 = No Rain, 1 = Rain)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Traffic Volume&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>The correlation between presence of rain and traffic volume is: 0.004175937441268289
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[60]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Calculating the correlation matrix</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[61]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Creating the heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Matrix of Variables&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>we can see there is a lot of weak correlation. lets use this data set for the first model, but we might adjust later if results are poor. We can see some evidence of multicolliniearity, but RNNs are robust and we will tackle with regularization techniques</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[62]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Display the first few rows of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>     temp  rain_1h  snow_1h  clouds_all  traffic_volume  weather_main_Clear  \
0  288.28      0.0      0.0          40            5545               False   
1  289.36      0.0      0.0          75            4516               False   
2  289.58      0.0      0.0          90            4767               False   
3  290.13      0.0      0.0          90            5026               False   
4  291.14      0.0      0.0          75            4918               False   

   weather_main_Clouds  weather_main_Drizzle  weather_main_Fog  \
0                 True                 False             False   
1                 True                 False             False   
2                 True                 False             False   
3                 True                 False             False   
4                 True                 False             False   

   weather_main_Haze  ...  weather_description_very heavy rain  hour  day  \
0              False  ...                                False     9    1   
1              False  ...                                False    10    1   
2              False  ...                                False    11    1   
3              False  ...                                False    12    1   
4              False  ...                                False    13    1   

   month  year      sin_hour  cos_hour  sin_month  cos_month  rain_present  
0     10  2012  7.071068e-01 -0.707107  -0.866025        0.5             0  
1     10  2012  5.000000e-01 -0.866025  -0.866025        0.5             0  
2     10  2012  2.588190e-01 -0.965926  -0.866025        0.5             0  
3     10  2012  1.224647e-16 -1.000000  -0.866025        0.5             0  
4     10  2012 -2.588190e-01 -0.965926  -0.866025        0.5             0  

[5 rows x 60 columns]
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p>Let&#39;s take a glance at the data. Here are the first few rows:</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[63]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Summary stats</span>
<span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[63]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult">

  <div class="colab-df-container">
    <div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temp</th>
      <th>rain_1h</th>
      <th>snow_1h</th>
      <th>clouds_all</th>
      <th>traffic_volume</th>
      <th>hour</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>sin_hour</th>
      <th>cos_hour</th>
      <th>sin_month</th>
      <th>cos_month</th>
      <th>rain_present</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>40575.000000</td>
      <td>4.057500e+04</td>
      <td>4.057500e+04</td>
      <td>4.057500e+04</td>
      <td>40575.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>281.386476</td>
      <td>0.041438</td>
      <td>0.000117</td>
      <td>44.199162</td>
      <td>3290.650474</td>
      <td>11.514750</td>
      <td>3.006778</td>
      <td>6.489045</td>
      <td>2015.479729</td>
      <td>-0.001680</td>
      <td>5.320098e-03</td>
      <td>-8.509186e-03</td>
      <td>-4.366938e-02</td>
      <td>0.050622</td>
    </tr>
    <tr>
      <th>std</th>
      <td>13.091592</td>
      <td>0.226512</td>
      <td>0.005676</td>
      <td>38.683447</td>
      <td>1984.772909</td>
      <td>6.949889</td>
      <td>1.998947</td>
      <td>3.373618</td>
      <td>1.888817</td>
      <td>0.705984</td>
      <td>7.082228e-01</td>
      <td>7.018118e-01</td>
      <td>7.109890e-01</td>
      <td>0.219228</td>
    </tr>
    <tr>
      <th>min</th>
      <td>243.390000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2012.000000</td>
      <td>-1.000000</td>
      <td>-1.000000e+00</td>
      <td>-1.000000e+00</td>
      <td>-1.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>271.850000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1248.500000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>2014.000000</td>
      <td>-0.707107</td>
      <td>-7.071068e-01</td>
      <td>-5.000000e-01</td>
      <td>-8.660254e-01</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>282.860000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.000000</td>
      <td>3427.000000</td>
      <td>12.000000</td>
      <td>3.000000</td>
      <td>7.000000</td>
      <td>2016.000000</td>
      <td>0.000000</td>
      <td>6.123234e-17</td>
      <td>-2.449294e-16</td>
      <td>-1.836970e-16</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>292.280000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>90.000000</td>
      <td>4952.000000</td>
      <td>18.000000</td>
      <td>5.000000</td>
      <td>9.000000</td>
      <td>2017.000000</td>
      <td>0.707107</td>
      <td>7.071068e-01</td>
      <td>5.000000e-01</td>
      <td>5.000000e-01</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>310.070000</td>
      <td>1.780000</td>
      <td>0.510000</td>
      <td>100.000000</td>
      <td>7280.000000</td>
      <td>23.000000</td>
      <td>6.000000</td>
      <td>12.000000</td>
      <td>2018.000000</td>
      <td>1.000000</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    

  
    
  
    

  

    
  </div>


<div>
  


    
        
    

  



  
</div>

    </div>
  </div>

</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[64]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Checking for missing values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>temp                                                       0
rain_1h                                                    0
snow_1h                                                    0
clouds_all                                                 0
traffic_volume                                             0
weather_main_Clear                                         0
weather_main_Clouds                                        0
weather_main_Drizzle                                       0
weather_main_Fog                                           0
weather_main_Haze                                          0
weather_main_Mist                                          0
weather_main_Rain                                          0
weather_main_Smoke                                         0
weather_main_Snow                                          0
weather_main_Squall                                        0
weather_main_Thunderstorm                                  0
weather_description_SQUALLS                                0
weather_description_Sky is Clear                           0
weather_description_broken clouds                          0
weather_description_drizzle                                0
weather_description_few clouds                             0
weather_description_fog                                    0
weather_description_freezing rain                          0
weather_description_haze                                   0
weather_description_heavy intensity drizzle                0
weather_description_heavy intensity rain                   0
weather_description_heavy snow                             0
weather_description_light intensity drizzle                0
weather_description_light intensity shower rain            0
weather_description_light rain                             0
weather_description_light rain and snow                    0
weather_description_light shower snow                      0
weather_description_light snow                             0
weather_description_mist                                   0
weather_description_moderate rain                          0
weather_description_overcast clouds                        0
weather_description_proximity shower rain                  0
weather_description_proximity thunderstorm                 0
weather_description_proximity thunderstorm with drizzle    0
weather_description_proximity thunderstorm with rain       0
weather_description_scattered clouds                       0
weather_description_sky is clear                           0
weather_description_sleet                                  0
weather_description_smoke                                  0
weather_description_snow                                   0
weather_description_thunderstorm                           0
weather_description_thunderstorm with heavy rain           0
weather_description_thunderstorm with light drizzle        0
weather_description_thunderstorm with light rain           0
weather_description_thunderstorm with rain                 0
weather_description_very heavy rain                        0
hour                                                       0
day                                                        0
month                                                      0
year                                                       0
sin_hour                                                   0
cos_hour                                                   0
sin_month                                                  0
cos_month                                                  0
rain_present                                               0
dtype: int64
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[65]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>     temp  rain_1h  snow_1h  clouds_all  traffic_volume  weather_main_Clear  \
0  288.28      0.0      0.0          40            5545               False   
1  289.36      0.0      0.0          75            4516               False   
2  289.58      0.0      0.0          90            4767               False   
3  290.13      0.0      0.0          90            5026               False   
4  291.14      0.0      0.0          75            4918               False   

   weather_main_Clouds  weather_main_Drizzle  weather_main_Fog  \
0                 True                 False             False   
1                 True                 False             False   
2                 True                 False             False   
3                 True                 False             False   
4                 True                 False             False   

   weather_main_Haze  ...  weather_description_very heavy rain  hour  day  \
0              False  ...                                False     9    1   
1              False  ...                                False    10    1   
2              False  ...                                False    11    1   
3              False  ...                                False    12    1   
4              False  ...                                False    13    1   

   month  year      sin_hour  cos_hour  sin_month  cos_month  rain_present  
0     10  2012  7.071068e-01 -0.707107  -0.866025        0.5             0  
1     10  2012  5.000000e-01 -0.866025  -0.866025        0.5             0  
2     10  2012  2.588190e-01 -0.965926  -0.866025        0.5             0  
3     10  2012  1.224647e-16 -1.000000  -0.866025        0.5             0  
4     10  2012 -2.588190e-01 -0.965926  -0.866025        0.5             0  

[5 rows x 60 columns]
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<hr/>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2>Train, Test, Val Split<a rel="noopener" class="anchor-link" href="#Train,-Test,-Val-Split">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[66]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">35575</span><span class="p">]</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">35575</span><span class="p">:</span><span class="mi">40575</span><span class="p">]</span>

<span class="n">validation_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="p">))</span>  <span class="c1"># 10% of training data</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">validation_size</span><span class="p">:]</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="n">validation_size</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[67]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Print the number of instances in each dataset to confirm sizes</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of instances in:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training set: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation set: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">val_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test set: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Number of instances in:
Training set: 32018
Validation set: 3557
Test set: 5000
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2>Normalize data<a rel="noopener" class="anchor-link" href="#Normalize-data">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[68]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[69]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Normalize the &#39;traffic_volume&#39; using only the training set</span>
<span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">[[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[70]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Apply the same transformation to the validation and test sets</span>
<span class="n">val_df</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">val_df</span><span class="p">[[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]])</span>
<span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]])</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>&lt;ipython-input-70-ef12edafdde2&gt;:3: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  test_df[&#39;traffic_volume&#39;] = scaler.transform(test_df[[&#39;traffic_volume&#39;]])
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Data windowing</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[71]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">WindowGenerator</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_width</span><span class="p">,</span> <span class="n">label_width</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span>
                 <span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="o">=</span><span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="o">=</span><span class="n">test_df</span><span class="p">,</span>
                 <span class="n">label_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Store the raw data.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_df</span> <span class="o">=</span> <span class="n">val_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span>

        <span class="c1"># Work out the label column indices.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="o">=</span> <span class="n">label_columns</span>
        <span class="k">if</span> <span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_columns_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span>
                                          <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_columns</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span>
                               <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>

        <span class="c1"># Work out the window parameters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span> <span class="o">=</span> <span class="n">input_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span> <span class="o">=</span> <span class="n">label_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">=</span> <span class="n">input_width</span> <span class="o">+</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">input_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">split_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
                <span class="p">[</span><span class="n">labels</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">],</span>
                <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Slicing doesn&#39;t preserve static shape information, so set the shapes manually.</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">timeseries_dataset_from_array</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">sequence_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">,</span>
            <span class="n">sequence_stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">split_window</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ds</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_col</span><span class="o">=</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">,</span> <span class="n">max_subplots</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">example</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">plot_col_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="n">plot_col</span><span class="p">]</span>
        <span class="n">max_n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_subplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_n</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">max_n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">plot_col</span><span class="si">}</span><span class="s1"> [normed]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span><span class="p">,</span> <span class="n">inputs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">plot_col_index</span><span class="p">],</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Inputs&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">:</span>
                <span class="n">label_col_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plot_col</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label_col_index</span> <span class="o">=</span> <span class="n">plot_col_index</span>

            <span class="k">if</span> <span class="n">label_col_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">label_col_index</span><span class="p">],</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Labels&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#2ca02c&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
                <span class="c1"># Adjusting prediction index to match label_indices</span>
                <span class="c1"># Assuming label indices point to the last step in each sequence for prediction</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">label_col_index</span><span class="p">],</span>
                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predictions&#39;</span><span class="p">,</span>
                            <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#ff7f0e&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [h]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="sa">f</span><span class="s1">&#39;Total window size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;Input indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;Label indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;Label column name(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>



    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_df</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_df</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get and cache an example batch of `inputs, labels` for plotting.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_example&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># No example batch was found, so get one from the `.train` dataset</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
            <span class="c1"># And cache it for next time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_example</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[72]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Assume &#39;traffic_volume&#39; is the label we want to predict</span>
<span class="n">label_column</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]</span>

<span class="c1"># Create the WindowGenerator object</span>
<span class="n">w1</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                     <span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="o">=</span><span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="o">=</span><span class="n">test_df</span><span class="p">,</span>
                     <span class="n">label_columns</span><span class="o">=</span><span class="n">label_column</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Total window size: 15
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11]
Label indices: [14]
Label column name(s): [&#39;traffic_volume&#39;]
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[73]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inputs shape: </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Labels shape: </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Inputs shape: (32, 12, 60)
Labels shape: (32, 1, 1)
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2>Baseline Model<a rel="noopener" class="anchor-link" href="#Baseline-Model">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[74]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Baseline</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span> <span class="o">=</span> <span class="n">label_index</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inputs</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">tf</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="c1"># Assuming &#39;traffic_volume&#39; is the label we want to predict</span>
<span class="n">label_column_index</span> <span class="o">=</span> <span class="n">w1</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">]</span>
<span class="n">baseline</span> <span class="o">=</span> <span class="n">Baseline</span><span class="p">(</span><span class="n">label_index</span><span class="o">=</span><span class="n">label_column_index</span><span class="p">)</span>

<span class="n">baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                 <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Evaluate the baseline model</span>
<span class="n">val_performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 3ms/step - loss: 2.3806 - mean_absolute_error: 1.3181
Validation performance: {&#39;loss&#39;: 2.3805506229400635, &#39;mean_absolute_error&#39;: 1.3181401491165161}
Test performance: {&#39;loss&#39;: 2.450911521911621, &#39;mean_absolute_error&#39;: 1.3377220630645752}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2>BASELINE LSTM RNN<a rel="noopener" class="anchor-link" href="#BASELINE-LSTM-RNN">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[75]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Early stopping to prevent overfitting in case i want to add it later</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>

<span class="c1"># lr scheduler to reduce on plateau</span>
<span class="n">reduce_lr</span> <span class="o">=</span> <span class="n">ReduceLROnPlateau</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_lr</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[76]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">input_width</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">lstm_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                   <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
                   <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the LSTM model</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                         <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                         <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>

<span class="c1"># Evaluate the LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lstm_model</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 11s 8ms/step - loss: 1.0010 - mean_absolute_error: 0.8771 - val_loss: 0.9830 - val_mean_absolute_error: 0.8646 - lr: 0.0010
Epoch 2/20
1001/1001 [==============================] - 6s 6ms/step - loss: 1.0003 - mean_absolute_error: 0.8774 - val_loss: 0.9830 - val_mean_absolute_error: 0.8646 - lr: 0.0010
Epoch 3/20
1001/1001 [==============================] - 7s 7ms/step - loss: 1.0003 - mean_absolute_error: 0.8774 - val_loss: 0.9830 - val_mean_absolute_error: 0.8646 - lr: 0.0010
Epoch 4/20
 999/1001 [============================&gt;.] - ETA: 0s - loss: 1.0004 - mean_absolute_error: 0.8775
Epoch 4: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
1001/1001 [==============================] - 8s 8ms/step - loss: 1.0003 - mean_absolute_error: 0.8774 - val_loss: 0.9830 - val_mean_absolute_error: 0.8646 - lr: 0.0010
Epoch 5/20
1001/1001 [==============================] - 6s 6ms/step - loss: 1.0009 - mean_absolute_error: 0.8777 - val_loss: 0.9793 - val_mean_absolute_error: 0.8644 - lr: 5.0000e-04
Epoch 6/20
1001/1001 [==============================] - 8s 8ms/step - loss: 1.0007 - mean_absolute_error: 0.8776 - val_loss: 0.9793 - val_mean_absolute_error: 0.8644 - lr: 5.0000e-04
Epoch 7/20
1001/1001 [==============================] - 8s 8ms/step - loss: 1.0007 - mean_absolute_error: 0.8776 - val_loss: 0.9793 - val_mean_absolute_error: 0.8644 - lr: 5.0000e-04
Epoch 8/20
 992/1001 [============================&gt;.] - ETA: 0s - loss: 1.0001 - mean_absolute_error: 0.8772
Epoch 8: ReduceLROnPlateau reducing learning rate to 0.0002500000118743628.
1001/1001 [==============================] - 7s 7ms/step - loss: 1.0007 - mean_absolute_error: 0.8776 - val_loss: 0.9793 - val_mean_absolute_error: 0.8644 - lr: 5.0000e-04
Epoch 9/20
1001/1001 [==============================] - 8s 8ms/step - loss: 1.0010 - mean_absolute_error: 0.8777 - val_loss: 0.9764 - val_mean_absolute_error: 0.8645 - lr: 2.5000e-04
Epoch 10/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.9856 - mean_absolute_error: 0.8690 - val_loss: 0.9158 - val_mean_absolute_error: 0.8319 - lr: 2.5000e-04
Epoch 11/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.9187 - mean_absolute_error: 0.8333 - val_loss: 0.8564 - val_mean_absolute_error: 0.8000 - lr: 2.5000e-04
Epoch 12/20
1001/1001 [==============================] - 7s 7ms/step - loss: 0.8805 - mean_absolute_error: 0.8108 - val_loss: 0.8241 - val_mean_absolute_error: 0.7809 - lr: 2.5000e-04
Epoch 13/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.8561 - mean_absolute_error: 0.7948 - val_loss: 0.8007 - val_mean_absolute_error: 0.7660 - lr: 2.5000e-04
Epoch 14/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.8388 - mean_absolute_error: 0.7824 - val_loss: 0.7831 - val_mean_absolute_error: 0.7543 - lr: 2.5000e-04
Epoch 15/20
1001/1001 [==============================] - 7s 7ms/step - loss: 0.8262 - mean_absolute_error: 0.7725 - val_loss: 0.7698 - val_mean_absolute_error: 0.7448 - lr: 2.5000e-04
Epoch 16/20
1001/1001 [==============================] - 6s 6ms/step - loss: 0.8167 - mean_absolute_error: 0.7644 - val_loss: 0.7598 - val_mean_absolute_error: 0.7371 - lr: 2.5000e-04
Epoch 17/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.8096 - mean_absolute_error: 0.7579 - val_loss: 0.7521 - val_mean_absolute_error: 0.7308 - lr: 2.5000e-04
Epoch 18/20
1001/1001 [==============================] - 7s 7ms/step - loss: 0.8041 - mean_absolute_error: 0.7525 - val_loss: 0.7463 - val_mean_absolute_error: 0.7257 - lr: 2.5000e-04
Epoch 19/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.8000 - mean_absolute_error: 0.7482 - val_loss: 0.7419 - val_mean_absolute_error: 0.7216 - lr: 2.5000e-04
Epoch 20/20
1001/1001 [==============================] - 7s 7ms/step - loss: 0.7969 - mean_absolute_error: 0.7448 - val_loss: 0.7386 - val_mean_absolute_error: 0.7184 - lr: 2.5000e-04
111/111 [==============================] - 1s 7ms/step - loss: 0.7386 - mean_absolute_error: 0.7184
Validation performance: {&#39;loss&#39;: 0.738574743270874, &#39;mean_absolute_error&#39;: 0.7183976769447327}
Test performance: {&#39;loss&#39;: 0.7439204454421997, &#39;mean_absolute_error&#39;: 0.7156895399093628}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>baseline model evaluation</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[77]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_training_history</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>
    <span class="c1"># Plot training &amp; validation loss values</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model loss&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Plot training &amp; validation MAE values</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_mean_absolute_error&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Mean Absolute Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[78]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">plot_training_history</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Significant underfitting and obvious lack of improvement over epochs. need to increase complexity</strong></p>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1><strong>THE BEST MODEL IS THE BIRDIRECTIONAL LSTM MODEL WITH 3 BIRECTIONAL LSTM LAYERS, 3 DROPOUT LAYERS EACH SET AT 0.02, AND L2 REGULARIZATION SET TO 0.001 PENALTY</strong><a rel="noopener" class="anchor-link" href="#THE-BEST-MODEL-IS-THE-BIRDIRECTIONAL-LSTM-MODEL-WITH-3-BIRECTIONAL-LSTM-LAYERS,-3-DROPOUT-LAYERS-EACH-SET-AT-0.02,-AND-L2-REGULARIZATION-SET-TO-0.001-PENALTY">&#182;</a></h1>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[79]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">bidirectional_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the bidirectional LSTM model</span>
<span class="n">history_bidirectional_lstm</span> <span class="o">=</span> <span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                        <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                                        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>

<span class="c1"># Evaluate the bidirectional LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_bidirectional_lstm</span><span class="p">)</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bidirectional_lstm_model</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 31s 19ms/step - loss: 1.3926 - mean_absolute_error: 0.6302 - val_loss: 0.8542 - val_mean_absolute_error: 0.5121 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 21s 21ms/step - loss: 0.7519 - mean_absolute_error: 0.4885 - val_loss: 0.6878 - val_mean_absolute_error: 0.4928 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 18s 18ms/step - loss: 0.6277 - mean_absolute_error: 0.4632 - val_loss: 0.5696 - val_mean_absolute_error: 0.4548 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.5643 - mean_absolute_error: 0.4521 - val_loss: 0.4875 - val_mean_absolute_error: 0.4122 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.5156 - mean_absolute_error: 0.4405 - val_loss: 0.4489 - val_mean_absolute_error: 0.3996 - lr: 1.0000e-04
Epoch 6/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.4829 - mean_absolute_error: 0.4338 - val_loss: 0.4237 - val_mean_absolute_error: 0.3934 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.4535 - mean_absolute_error: 0.4269 - val_loss: 0.4180 - val_mean_absolute_error: 0.4096 - lr: 1.0000e-04
Epoch 8/20
1001/1001 [==============================] - 19s 19ms/step - loss: 0.4340 - mean_absolute_error: 0.4237 - val_loss: 0.4085 - val_mean_absolute_error: 0.4054 - lr: 1.0000e-04
Epoch 9/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.4108 - mean_absolute_error: 0.4153 - val_loss: 0.4023 - val_mean_absolute_error: 0.4015 - lr: 1.0000e-04
Epoch 10/20
1001/1001 [==============================] - 18s 18ms/step - loss: 0.4020 - mean_absolute_error: 0.4203 - val_loss: 0.5033 - val_mean_absolute_error: 0.4700 - lr: 1.0000e-04
Epoch 11/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3821 - mean_absolute_error: 0.4075 - val_loss: 0.3923 - val_mean_absolute_error: 0.3917 - lr: 1.0000e-04
Epoch 12/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3589 - mean_absolute_error: 0.3933 - val_loss: 0.3703 - val_mean_absolute_error: 0.3791 - lr: 1.0000e-04
Epoch 13/20
1001/1001 [==============================] - 17s 16ms/step - loss: 0.3417 - mean_absolute_error: 0.3825 - val_loss: 0.3532 - val_mean_absolute_error: 0.3650 - lr: 1.0000e-04
Epoch 14/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.3291 - mean_absolute_error: 0.3746 - val_loss: 0.3142 - val_mean_absolute_error: 0.3400 - lr: 1.0000e-04
Epoch 15/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3211 - mean_absolute_error: 0.3711 - val_loss: 0.3211 - val_mean_absolute_error: 0.3524 - lr: 1.0000e-04
Epoch 16/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3123 - mean_absolute_error: 0.3663 - val_loss: 0.3265 - val_mean_absolute_error: 0.3498 - lr: 1.0000e-04
Epoch 17/20
 999/1001 [============================&gt;.] - ETA: 0s - loss: 0.3017 - mean_absolute_error: 0.3590
Epoch 17: ReduceLROnPlateau reducing learning rate to 4.999999873689376e-05.
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3015 - mean_absolute_error: 0.3589 - val_loss: 0.3390 - val_mean_absolute_error: 0.3531 - lr: 1.0000e-04
Epoch 18/20
1001/1001 [==============================] - 18s 18ms/step - loss: 0.2882 - mean_absolute_error: 0.3470 - val_loss: 0.3373 - val_mean_absolute_error: 0.3529 - lr: 5.0000e-05
Epoch 19/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.2846 - mean_absolute_error: 0.3433 - val_loss: 0.3262 - val_mean_absolute_error: 0.3477 - lr: 5.0000e-05
Epoch 20/20
 999/1001 [============================&gt;.] - ETA: 0s - loss: 0.2776 - mean_absolute_error: 0.3389
Epoch 20: ReduceLROnPlateau reducing learning rate to 2.499999936844688e-05.
1001/1001 [==============================] - 16s 16ms/step - loss: 0.2775 - mean_absolute_error: 0.3389 - val_loss: 0.3349 - val_mean_absolute_error: 0.3538 - lr: 5.0000e-05
111/111 [==============================] - 1s 7ms/step - loss: 0.3349 - mean_absolute_error: 0.3538
Validation performance: {&#39;loss&#39;: 0.33486858010292053, &#39;mean_absolute_error&#39;: 0.35376593470573425}
Test performance: {&#39;loss&#39;: 0.19200703501701355, &#39;mean_absolute_error&#39;: 0.2439209669828415}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[79]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Below is the first model tested after Baseling LSTM model</strong></p>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Lets add more units and dropout layers first</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[80]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">complexNoDO_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">complexNoDO_lstm_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                            <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
                            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the improved LSTM model</span>
<span class="n">history_ComplxPlusDO</span> <span class="o">=</span> <span class="n">complexNoDO_lstm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                           <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                           <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 14s 9ms/step - loss: 1.0018 - mean_absolute_error: 0.8768 - val_loss: 0.9857 - val_mean_absolute_error: 0.8649 - lr: 0.0010
Epoch 2/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.9984 - mean_absolute_error: 0.8762 - val_loss: 0.9852 - val_mean_absolute_error: 0.8648 - lr: 0.0010
Epoch 3/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.9978 - mean_absolute_error: 0.8761 - val_loss: 0.9864 - val_mean_absolute_error: 0.8650 - lr: 0.0010
Epoch 4/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.9981 - mean_absolute_error: 0.8763 - val_loss: 0.9859 - val_mean_absolute_error: 0.8649 - lr: 0.0010
Epoch 5/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.9987 - mean_absolute_error: 0.8767 - val_loss: 0.9845 - val_mean_absolute_error: 0.8647 - lr: 0.0010
Epoch 6/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.9993 - mean_absolute_error: 0.8770 - val_loss: 0.9835 - val_mean_absolute_error: 0.8646 - lr: 0.0010
Epoch 7/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.9997 - mean_absolute_error: 0.8772 - val_loss: 0.9827 - val_mean_absolute_error: 0.8646 - lr: 0.0010
Epoch 8/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0000 - mean_absolute_error: 0.8774 - val_loss: 0.9819 - val_mean_absolute_error: 0.8645 - lr: 0.0010
Epoch 9/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0002 - mean_absolute_error: 0.8775 - val_loss: 0.9809 - val_mean_absolute_error: 0.8644 - lr: 0.0010
Epoch 10/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0004 - mean_absolute_error: 0.8776 - val_loss: 0.9800 - val_mean_absolute_error: 0.8644 - lr: 0.0010
Epoch 11/20
1001/1001 [==============================] - 8s 8ms/step - loss: 1.0004 - mean_absolute_error: 0.8776 - val_loss: 0.9789 - val_mean_absolute_error: 0.8643 - lr: 0.0010
Epoch 12/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0005 - mean_absolute_error: 0.8776 - val_loss: 0.9782 - val_mean_absolute_error: 0.8643 - lr: 0.0010
Epoch 13/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0005 - mean_absolute_error: 0.8776 - val_loss: 0.9772 - val_mean_absolute_error: 0.8643 - lr: 0.0010
Epoch 14/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0005 - mean_absolute_error: 0.8776 - val_loss: 0.9767 - val_mean_absolute_error: 0.8644 - lr: 0.0010
Epoch 15/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0005 - mean_absolute_error: 0.8776 - val_loss: 0.9770 - val_mean_absolute_error: 0.8644 - lr: 0.0010
Epoch 16/20
1001/1001 [==============================] - 10s 10ms/step - loss: 1.0005 - mean_absolute_error: 0.8776 - val_loss: 0.9767 - val_mean_absolute_error: 0.8644 - lr: 0.0010
Epoch 17/20
 994/1001 [============================&gt;.] - ETA: 0s - loss: 1.0002 - mean_absolute_error: 0.8774
Epoch 17: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0004 - mean_absolute_error: 0.8776 - val_loss: 0.9780 - val_mean_absolute_error: 0.8643 - lr: 0.0010
Epoch 18/20
1001/1001 [==============================] - 8s 8ms/step - loss: 1.0006 - mean_absolute_error: 0.8775 - val_loss: 0.9752 - val_mean_absolute_error: 0.8646 - lr: 5.0000e-04
Epoch 19/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0004 - mean_absolute_error: 0.8776 - val_loss: 0.9752 - val_mean_absolute_error: 0.8647 - lr: 5.0000e-04
Epoch 20/20
1001/1001 [==============================] - 9s 9ms/step - loss: 1.0004 - mean_absolute_error: 0.8776 - val_loss: 0.9752 - val_mean_absolute_error: 0.8647 - lr: 5.0000e-04
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[81]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">complexNoDO_lstm_model</span><span class="p">)</span>

<span class="c1"># Evaluate the improved LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexNoDO_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexNoDO_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_ComplxPlusDO</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 5ms/step - loss: 0.9752 - mean_absolute_error: 0.8647
Validation performance: {&#39;loss&#39;: 0.9751701951026917, &#39;mean_absolute_error&#39;: 0.8646592497825623}
Test performance: {&#39;loss&#39;: 1.0001928806304932, &#39;mean_absolute_error&#39;: 0.875971257686615}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>First good enough model</strong></p>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Reducing the LR rate</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[82]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">complexPlus_lstm_model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[83]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">complexPlus_lstm_model_2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                            <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the improved LSTM model</span>
<span class="n">history_ComplxPlus_2</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                           <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                           <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 14s 9ms/step - loss: 0.9045 - mean_absolute_error: 0.8216 - val_loss: 1.1701 - val_mean_absolute_error: 0.8907 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.7985 - mean_absolute_error: 0.7501 - val_loss: 1.3513 - val_mean_absolute_error: 0.9577 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.7474 - mean_absolute_error: 0.7153 - val_loss: 1.2826 - val_mean_absolute_error: 0.9329 - lr: 1.0000e-04
Epoch 4/20
 994/1001 [============================&gt;.] - ETA: 0s - loss: 0.7124 - mean_absolute_error: 0.6908
Epoch 4: ReduceLROnPlateau reducing learning rate to 4.999999873689376e-05.
1001/1001 [==============================] - 8s 8ms/step - loss: 0.7114 - mean_absolute_error: 0.6902 - val_loss: 1.2122 - val_mean_absolute_error: 0.9044 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6910 - mean_absolute_error: 0.6768 - val_loss: 1.2700 - val_mean_absolute_error: 0.9261 - lr: 5.0000e-05
Epoch 6/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6711 - mean_absolute_error: 0.6646 - val_loss: 1.1608 - val_mean_absolute_error: 0.8797 - lr: 5.0000e-05
Epoch 7/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.6511 - mean_absolute_error: 0.6513 - val_loss: 1.1146 - val_mean_absolute_error: 0.8594 - lr: 5.0000e-05
Epoch 8/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6330 - mean_absolute_error: 0.6396 - val_loss: 1.0763 - val_mean_absolute_error: 0.8425 - lr: 5.0000e-05
Epoch 9/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6144 - mean_absolute_error: 0.6276 - val_loss: 1.0396 - val_mean_absolute_error: 0.8266 - lr: 5.0000e-05
Epoch 10/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5976 - mean_absolute_error: 0.6163 - val_loss: 1.0030 - val_mean_absolute_error: 0.8114 - lr: 5.0000e-05
Epoch 11/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5838 - mean_absolute_error: 0.6063 - val_loss: 0.9713 - val_mean_absolute_error: 0.7981 - lr: 5.0000e-05
Epoch 12/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5724 - mean_absolute_error: 0.5975 - val_loss: 0.9473 - val_mean_absolute_error: 0.7875 - lr: 5.0000e-05
Epoch 13/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5629 - mean_absolute_error: 0.5899 - val_loss: 0.9288 - val_mean_absolute_error: 0.7789 - lr: 5.0000e-05
Epoch 14/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.5547 - mean_absolute_error: 0.5832 - val_loss: 0.9130 - val_mean_absolute_error: 0.7716 - lr: 5.0000e-05
Epoch 15/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5474 - mean_absolute_error: 0.5772 - val_loss: 0.8983 - val_mean_absolute_error: 0.7647 - lr: 5.0000e-05
Epoch 16/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5406 - mean_absolute_error: 0.5718 - val_loss: 0.8837 - val_mean_absolute_error: 0.7581 - lr: 5.0000e-05
Epoch 17/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.5344 - mean_absolute_error: 0.5668 - val_loss: 0.8691 - val_mean_absolute_error: 0.7516 - lr: 5.0000e-05
Epoch 18/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5286 - mean_absolute_error: 0.5622 - val_loss: 0.8544 - val_mean_absolute_error: 0.7452 - lr: 5.0000e-05
Epoch 19/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5233 - mean_absolute_error: 0.5579 - val_loss: 0.8400 - val_mean_absolute_error: 0.7388 - lr: 5.0000e-05
Epoch 20/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5182 - mean_absolute_error: 0.5538 - val_loss: 0.8260 - val_mean_absolute_error: 0.7326 - lr: 5.0000e-05
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[84]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">complexPlus_lstm_model_2</span><span class="p">)</span>

<span class="c1"># Evaluate the improved LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_ComplxPlus_2</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 5ms/step - loss: 0.8260 - mean_absolute_error: 0.7326
Validation performance: {&#39;loss&#39;: 0.8259882926940918, &#39;mean_absolute_error&#39;: 0.7325537800788879}
Test performance: {&#39;loss&#39;: 0.4886075556278229, &#39;mean_absolute_error&#39;: 0.5356689095497131}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Adding Dropout layers to reduce overfitting</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[85]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">complexPlus_lstm_model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">complexPlus_lstm_model_1</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                            <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the improved LSTM model</span>
<span class="n">history_ComplxPlus_1</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                           <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                           <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">complexPlus_lstm_model_1</span><span class="p">)</span>

<span class="c1"># Evaluate the improved LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_ComplxPlus_1</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 14s 10ms/step - loss: 0.9686 - mean_absolute_error: 0.8560 - val_loss: 0.8964 - val_mean_absolute_error: 0.7944 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.8242 - mean_absolute_error: 0.7649 - val_loss: 0.9259 - val_mean_absolute_error: 0.8066 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.7578 - mean_absolute_error: 0.7189 - val_loss: 0.8858 - val_mean_absolute_error: 0.7863 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 10s 9ms/step - loss: 0.7341 - mean_absolute_error: 0.7023 - val_loss: 0.9223 - val_mean_absolute_error: 0.8005 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.7218 - mean_absolute_error: 0.6934 - val_loss: 0.9075 - val_mean_absolute_error: 0.7906 - lr: 1.0000e-04
Epoch 6/20
1000/1001 [============================&gt;.] - ETA: 0s - loss: 0.7080 - mean_absolute_error: 0.6836
Epoch 6: ReduceLROnPlateau reducing learning rate to 4.999999873689376e-05.
1001/1001 [==============================] - 10s 10ms/step - loss: 0.7081 - mean_absolute_error: 0.6837 - val_loss: 0.8957 - val_mean_absolute_error: 0.7817 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.7006 - mean_absolute_error: 0.6773 - val_loss: 0.8835 - val_mean_absolute_error: 0.7750 - lr: 5.0000e-05
Epoch 8/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6996 - mean_absolute_error: 0.6758 - val_loss: 0.8915 - val_mean_absolute_error: 0.7778 - lr: 5.0000e-05
Epoch 9/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6950 - mean_absolute_error: 0.6729 - val_loss: 0.8689 - val_mean_absolute_error: 0.7656 - lr: 5.0000e-05
Epoch 10/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6908 - mean_absolute_error: 0.6701 - val_loss: 0.8604 - val_mean_absolute_error: 0.7606 - lr: 5.0000e-05
Epoch 11/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.6877 - mean_absolute_error: 0.6686 - val_loss: 0.8617 - val_mean_absolute_error: 0.7599 - lr: 5.0000e-05
Epoch 12/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6836 - mean_absolute_error: 0.6655 - val_loss: 0.8509 - val_mean_absolute_error: 0.7537 - lr: 5.0000e-05
Epoch 13/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6806 - mean_absolute_error: 0.6636 - val_loss: 0.8380 - val_mean_absolute_error: 0.7463 - lr: 5.0000e-05
Epoch 14/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6779 - mean_absolute_error: 0.6617 - val_loss: 0.8301 - val_mean_absolute_error: 0.7421 - lr: 5.0000e-05
Epoch 15/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6763 - mean_absolute_error: 0.6608 - val_loss: 0.8464 - val_mean_absolute_error: 0.7487 - lr: 5.0000e-05
Epoch 16/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6700 - mean_absolute_error: 0.6564 - val_loss: 0.8189 - val_mean_absolute_error: 0.7346 - lr: 5.0000e-05
Epoch 17/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6681 - mean_absolute_error: 0.6556 - val_loss: 0.8197 - val_mean_absolute_error: 0.7340 - lr: 5.0000e-05
Epoch 18/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6653 - mean_absolute_error: 0.6532 - val_loss: 0.7973 - val_mean_absolute_error: 0.7224 - lr: 5.0000e-05
Epoch 19/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6615 - mean_absolute_error: 0.6508 - val_loss: 0.7938 - val_mean_absolute_error: 0.7199 - lr: 5.0000e-05
Epoch 20/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6554 - mean_absolute_error: 0.6472 - val_loss: 0.7683 - val_mean_absolute_error: 0.7065 - lr: 5.0000e-05
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 5ms/step - loss: 0.7683 - mean_absolute_error: 0.7065
Validation performance: {&#39;loss&#39;: 0.768266499042511, &#39;mean_absolute_error&#39;: 0.70649254322052}
Test performance: {&#39;loss&#39;: 0.5841997861862183, &#39;mean_absolute_error&#39;: 0.6114326119422913}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Wild... lets adjust scheduler</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[86]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">reduce_lr_p5</span> <span class="o">=</span> <span class="n">ReduceLROnPlateau</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_lr</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[87]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">complexPlus_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">complexPlus_lstm_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                            <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the improved LSTM model</span>
<span class="n">history_ComplxPlus</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                           <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                           <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr_p5</span><span class="p">])</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">complexPlus_lstm_model</span><span class="p">)</span>

<span class="c1"># Evaluate the improved LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_ComplxPlus</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 14s 10ms/step - loss: 0.9795 - mean_absolute_error: 0.8641 - val_loss: 0.9031 - val_mean_absolute_error: 0.8139 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.8305 - mean_absolute_error: 0.7716 - val_loss: 0.8155 - val_mean_absolute_error: 0.7654 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.7635 - mean_absolute_error: 0.7248 - val_loss: 0.8434 - val_mean_absolute_error: 0.7818 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 8s 8ms/step - loss: 0.7369 - mean_absolute_error: 0.7058 - val_loss: 0.7565 - val_mean_absolute_error: 0.7332 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.7155 - mean_absolute_error: 0.6905 - val_loss: 0.7345 - val_mean_absolute_error: 0.7190 - lr: 1.0000e-04
Epoch 6/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.7030 - mean_absolute_error: 0.6816 - val_loss: 0.7092 - val_mean_absolute_error: 0.7037 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6878 - mean_absolute_error: 0.6711 - val_loss: 0.6786 - val_mean_absolute_error: 0.6847 - lr: 1.0000e-04
Epoch 8/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6759 - mean_absolute_error: 0.6639 - val_loss: 0.6657 - val_mean_absolute_error: 0.6763 - lr: 1.0000e-04
Epoch 9/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6633 - mean_absolute_error: 0.6559 - val_loss: 0.6669 - val_mean_absolute_error: 0.6771 - lr: 1.0000e-04
Epoch 10/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6520 - mean_absolute_error: 0.6492 - val_loss: 0.6306 - val_mean_absolute_error: 0.6540 - lr: 1.0000e-04
Epoch 11/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6348 - mean_absolute_error: 0.6385 - val_loss: 0.6269 - val_mean_absolute_error: 0.6509 - lr: 1.0000e-04
Epoch 12/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6106 - mean_absolute_error: 0.6231 - val_loss: 0.6314 - val_mean_absolute_error: 0.6519 - lr: 1.0000e-04
Epoch 13/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5881 - mean_absolute_error: 0.6066 - val_loss: 0.5803 - val_mean_absolute_error: 0.6173 - lr: 1.0000e-04
Epoch 14/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5721 - mean_absolute_error: 0.5954 - val_loss: 0.5975 - val_mean_absolute_error: 0.6262 - lr: 1.0000e-04
Epoch 15/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5586 - mean_absolute_error: 0.5857 - val_loss: 0.5838 - val_mean_absolute_error: 0.6158 - lr: 1.0000e-04
Epoch 16/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5477 - mean_absolute_error: 0.5771 - val_loss: 0.5729 - val_mean_absolute_error: 0.6075 - lr: 1.0000e-04
Epoch 17/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5367 - mean_absolute_error: 0.5690 - val_loss: 0.5407 - val_mean_absolute_error: 0.5875 - lr: 1.0000e-04
Epoch 18/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5298 - mean_absolute_error: 0.5642 - val_loss: 0.5648 - val_mean_absolute_error: 0.6025 - lr: 1.0000e-04
Epoch 19/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5215 - mean_absolute_error: 0.5575 - val_loss: 0.5032 - val_mean_absolute_error: 0.5630 - lr: 1.0000e-04
Epoch 20/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5165 - mean_absolute_error: 0.5543 - val_loss: 0.5355 - val_mean_absolute_error: 0.5846 - lr: 1.0000e-04
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 5ms/step - loss: 0.5355 - mean_absolute_error: 0.5846
Validation performance: {&#39;loss&#39;: 0.5355097651481628, &#39;mean_absolute_error&#39;: 0.5846064686775208}
Test performance: {&#39;loss&#39;: 0.3971576988697052, &#39;mean_absolute_error&#39;: 0.4928072690963745}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2><strong>significant model improvement!</strong><a rel="noopener" class="anchor-link" href="#significant-model-improvement!">&#182;</a></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p>it seems that we may not need an lr scheduler because the LR rate stayed at 0.0001, but I will keep it just in case. what if we increase number of epochs but also add an early stopping to make the training more efficient timewise</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[88]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">complexPlus_lstm_model_ep</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">complexPlus_lstm_model_ep</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                            <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the improved LSTM model</span>
<span class="n">history_ComplxPlus_ep</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_ep</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                                           <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                           <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr_p5</span><span class="p">])</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">complexPlus_lstm_model_ep</span><span class="p">)</span>

<span class="c1"># Evaluate the improved LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_ep</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexPlus_lstm_model_ep</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Improved_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_ComplxPlus_ep</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/25
1001/1001 [==============================] - 14s 10ms/step - loss: 0.9597 - mean_absolute_error: 0.8495 - val_loss: 0.9979 - val_mean_absolute_error: 0.8341 - lr: 1.0000e-04
Epoch 2/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.8311 - mean_absolute_error: 0.7678 - val_loss: 0.9715 - val_mean_absolute_error: 0.8249 - lr: 1.0000e-04
Epoch 3/25
1001/1001 [==============================] - 8s 8ms/step - loss: 0.7689 - mean_absolute_error: 0.7258 - val_loss: 0.9479 - val_mean_absolute_error: 0.8147 - lr: 1.0000e-04
Epoch 4/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.7437 - mean_absolute_error: 0.7087 - val_loss: 0.9104 - val_mean_absolute_error: 0.7950 - lr: 1.0000e-04
Epoch 5/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.7184 - mean_absolute_error: 0.6929 - val_loss: 0.8854 - val_mean_absolute_error: 0.7806 - lr: 1.0000e-04
Epoch 6/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.7032 - mean_absolute_error: 0.6831 - val_loss: 0.8714 - val_mean_absolute_error: 0.7707 - lr: 1.0000e-04
Epoch 7/25
1001/1001 [==============================] - 8s 8ms/step - loss: 0.6885 - mean_absolute_error: 0.6736 - val_loss: 0.8426 - val_mean_absolute_error: 0.7540 - lr: 1.0000e-04
Epoch 8/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6771 - mean_absolute_error: 0.6670 - val_loss: 0.8288 - val_mean_absolute_error: 0.7439 - lr: 1.0000e-04
Epoch 9/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6666 - mean_absolute_error: 0.6600 - val_loss: 0.8144 - val_mean_absolute_error: 0.7354 - lr: 1.0000e-04
Epoch 10/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6582 - mean_absolute_error: 0.6552 - val_loss: 0.8052 - val_mean_absolute_error: 0.7284 - lr: 1.0000e-04
Epoch 11/25
1001/1001 [==============================] - 8s 8ms/step - loss: 0.6484 - mean_absolute_error: 0.6488 - val_loss: 0.8056 - val_mean_absolute_error: 0.7269 - lr: 1.0000e-04
Epoch 12/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6369 - mean_absolute_error: 0.6410 - val_loss: 0.7918 - val_mean_absolute_error: 0.7181 - lr: 1.0000e-04
Epoch 13/25
1001/1001 [==============================] - 11s 11ms/step - loss: 0.6249 - mean_absolute_error: 0.6328 - val_loss: 0.7922 - val_mean_absolute_error: 0.7168 - lr: 1.0000e-04
Epoch 14/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6138 - mean_absolute_error: 0.6247 - val_loss: 0.7847 - val_mean_absolute_error: 0.7096 - lr: 1.0000e-04
Epoch 15/25
1001/1001 [==============================] - 8s 8ms/step - loss: 0.5997 - mean_absolute_error: 0.6152 - val_loss: 0.7445 - val_mean_absolute_error: 0.6873 - lr: 1.0000e-04
Epoch 16/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5891 - mean_absolute_error: 0.6075 - val_loss: 0.7466 - val_mean_absolute_error: 0.6870 - lr: 1.0000e-04
Epoch 17/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5786 - mean_absolute_error: 0.5994 - val_loss: 0.7110 - val_mean_absolute_error: 0.6678 - lr: 1.0000e-04
Epoch 18/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5665 - mean_absolute_error: 0.5910 - val_loss: 0.7017 - val_mean_absolute_error: 0.6603 - lr: 1.0000e-04
Epoch 19/25
1001/1001 [==============================] - 8s 8ms/step - loss: 0.5576 - mean_absolute_error: 0.5839 - val_loss: 0.6783 - val_mean_absolute_error: 0.6469 - lr: 1.0000e-04
Epoch 20/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5506 - mean_absolute_error: 0.5786 - val_loss: 0.6759 - val_mean_absolute_error: 0.6439 - lr: 1.0000e-04
Epoch 21/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5461 - mean_absolute_error: 0.5750 - val_loss: 0.6446 - val_mean_absolute_error: 0.6264 - lr: 1.0000e-04
Epoch 22/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5384 - mean_absolute_error: 0.5693 - val_loss: 0.6365 - val_mean_absolute_error: 0.6217 - lr: 1.0000e-04
Epoch 23/25
1001/1001 [==============================] - 8s 8ms/step - loss: 0.5348 - mean_absolute_error: 0.5668 - val_loss: 0.6319 - val_mean_absolute_error: 0.6192 - lr: 1.0000e-04
Epoch 24/25
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5291 - mean_absolute_error: 0.5626 - val_loss: 0.6071 - val_mean_absolute_error: 0.6032 - lr: 1.0000e-04
Epoch 25/25
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5239 - mean_absolute_error: 0.5580 - val_loss: 0.6155 - val_mean_absolute_error: 0.6087 - lr: 1.0000e-04
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 5ms/step - loss: 0.6155 - mean_absolute_error: 0.6087
Validation performance: {&#39;loss&#39;: 0.6154529452323914, &#39;mean_absolute_error&#39;: 0.6086803078651428}
Test performance: {&#39;loss&#39;: 0.44783440232276917, &#39;mean_absolute_error&#39;: 0.5212048292160034}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>somehow its overfitting and much worse in loss parameters... lets try to make the model more complex and increase dropout</strong></p>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>More complex lstm RNN</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[90]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">more_complex_lstm_model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">more_complex_lstm_model_1</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the more complex LSTM model</span>
<span class="n">history_more_complex_lstm_1</span> <span class="o">=</span> <span class="n">more_complex_lstm_model_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                        <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                                        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr_p5</span><span class="p">,</span> <span class="n">early_stopping</span><span class="p">])</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">more_complex_lstm_model_1</span><span class="p">)</span>

<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">more_complex_lstm_model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">more_complex_lstm_model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_more_complex_lstm_1</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 17s 13ms/step - loss: 0.9335 - mean_absolute_error: 0.8345 - val_loss: 0.7631 - val_mean_absolute_error: 0.7372 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.7971 - mean_absolute_error: 0.7454 - val_loss: 0.6793 - val_mean_absolute_error: 0.6840 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.7494 - mean_absolute_error: 0.7123 - val_loss: 0.6423 - val_mean_absolute_error: 0.6553 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.7207 - mean_absolute_error: 0.6922 - val_loss: 0.6069 - val_mean_absolute_error: 0.6338 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.6971 - mean_absolute_error: 0.6761 - val_loss: 0.6005 - val_mean_absolute_error: 0.6291 - lr: 1.0000e-04
Epoch 6/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.6792 - mean_absolute_error: 0.6644 - val_loss: 0.5746 - val_mean_absolute_error: 0.6084 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.6569 - mean_absolute_error: 0.6506 - val_loss: 0.6128 - val_mean_absolute_error: 0.6299 - lr: 1.0000e-04
Epoch 8/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.6213 - mean_absolute_error: 0.6277 - val_loss: 0.5905 - val_mean_absolute_error: 0.6127 - lr: 1.0000e-04
Epoch 9/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5946 - mean_absolute_error: 0.6093 - val_loss: 0.5739 - val_mean_absolute_error: 0.5929 - lr: 1.0000e-04
Epoch 10/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5687 - mean_absolute_error: 0.5903 - val_loss: 0.5887 - val_mean_absolute_error: 0.5938 - lr: 1.0000e-04
Epoch 11/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.5598 - mean_absolute_error: 0.5827 - val_loss: 0.5241 - val_mean_absolute_error: 0.5604 - lr: 1.0000e-04
Epoch 12/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.5429 - mean_absolute_error: 0.5702 - val_loss: 0.5540 - val_mean_absolute_error: 0.5706 - lr: 1.0000e-04
Epoch 13/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5326 - mean_absolute_error: 0.5622 - val_loss: 0.5546 - val_mean_absolute_error: 0.5700 - lr: 1.0000e-04
Epoch 14/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5229 - mean_absolute_error: 0.5554 - val_loss: 0.5692 - val_mean_absolute_error: 0.5694 - lr: 1.0000e-04
Epoch 15/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5128 - mean_absolute_error: 0.5475 - val_loss: 0.5314 - val_mean_absolute_error: 0.5505 - lr: 1.0000e-04
Epoch 16/20
 999/1001 [============================&gt;.] - ETA: 0s - loss: 0.5047 - mean_absolute_error: 0.5421
Epoch 16: ReduceLROnPlateau reducing learning rate to 4.999999873689376e-05.
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5046 - mean_absolute_error: 0.5421 - val_loss: 0.5821 - val_mean_absolute_error: 0.5702 - lr: 1.0000e-04
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 5ms/step - loss: 0.5821 - mean_absolute_error: 0.5702
Validation performance: {&#39;loss&#39;: 0.5821163058280945, &#39;mean_absolute_error&#39;: 0.5701901912689209}
Test performance: {&#39;loss&#39;: 0.31491756439208984, &#39;mean_absolute_error&#39;: 0.4190819561481476}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>too much complexity, lets add regularization. now that i think about it... regularization makes a lot of sense since we saw many variables seemingly useless in the eda</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[91]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">more_complex_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">more_complex_lstm_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the more complex LSTM model</span>
<span class="n">history_more_complex_lstm</span> <span class="o">=</span> <span class="n">more_complex_lstm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                        <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                                        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr_p5</span><span class="p">])</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">more_complex_lstm_model</span><span class="p">)</span>

<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">more_complex_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">more_complex_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;More_Complex_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_more_complex_lstm</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 18s 12ms/step - loss: 1.1481 - mean_absolute_error: 0.8109 - val_loss: 0.9786 - val_mean_absolute_error: 0.7675 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.8604 - mean_absolute_error: 0.7147 - val_loss: 0.8643 - val_mean_absolute_error: 0.7220 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.7894 - mean_absolute_error: 0.6833 - val_loss: 0.7415 - val_mean_absolute_error: 0.6634 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.7470 - mean_absolute_error: 0.6634 - val_loss: 0.7213 - val_mean_absolute_error: 0.6562 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.7153 - mean_absolute_error: 0.6497 - val_loss: 0.7170 - val_mean_absolute_error: 0.6574 - lr: 1.0000e-04
Epoch 6/20
1001/1001 [==============================] - 13s 13ms/step - loss: 0.6631 - mean_absolute_error: 0.6196 - val_loss: 0.6546 - val_mean_absolute_error: 0.6218 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.6301 - mean_absolute_error: 0.5992 - val_loss: 0.6080 - val_mean_absolute_error: 0.5917 - lr: 1.0000e-04
Epoch 8/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5980 - mean_absolute_error: 0.5771 - val_loss: 0.5834 - val_mean_absolute_error: 0.5792 - lr: 1.0000e-04
Epoch 9/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.5769 - mean_absolute_error: 0.5622 - val_loss: 0.5747 - val_mean_absolute_error: 0.5657 - lr: 1.0000e-04
Epoch 10/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.5541 - mean_absolute_error: 0.5457 - val_loss: 0.6094 - val_mean_absolute_error: 0.5795 - lr: 1.0000e-04
Epoch 11/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.5410 - mean_absolute_error: 0.5363 - val_loss: 0.5482 - val_mean_absolute_error: 0.5445 - lr: 1.0000e-04
Epoch 12/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5276 - mean_absolute_error: 0.5265 - val_loss: 0.4900 - val_mean_absolute_error: 0.5100 - lr: 1.0000e-04
Epoch 13/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.5273 - mean_absolute_error: 0.5264 - val_loss: 0.5962 - val_mean_absolute_error: 0.5684 - lr: 1.0000e-04
Epoch 14/20
1001/1001 [==============================] - 12s 12ms/step - loss: 0.5180 - mean_absolute_error: 0.5202 - val_loss: 0.5793 - val_mean_absolute_error: 0.5576 - lr: 1.0000e-04
Epoch 15/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5083 - mean_absolute_error: 0.5134 - val_loss: 0.5533 - val_mean_absolute_error: 0.5407 - lr: 1.0000e-04
Epoch 16/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5063 - mean_absolute_error: 0.5116 - val_loss: 0.5828 - val_mean_absolute_error: 0.5547 - lr: 1.0000e-04
Epoch 17/20
 995/1001 [============================&gt;.] - ETA: 0s - loss: 0.5006 - mean_absolute_error: 0.5079
Epoch 17: ReduceLROnPlateau reducing learning rate to 4.999999873689376e-05.
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4995 - mean_absolute_error: 0.5073 - val_loss: 0.5766 - val_mean_absolute_error: 0.5510 - lr: 1.0000e-04
Epoch 18/20
1001/1001 [==============================] - 12s 11ms/step - loss: 0.4998 - mean_absolute_error: 0.5040 - val_loss: 0.5917 - val_mean_absolute_error: 0.5517 - lr: 5.0000e-05
Epoch 19/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4950 - mean_absolute_error: 0.5015 - val_loss: 0.5804 - val_mean_absolute_error: 0.5448 - lr: 5.0000e-05
Epoch 20/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4923 - mean_absolute_error: 0.4986 - val_loss: 0.5742 - val_mean_absolute_error: 0.5423 - lr: 5.0000e-05
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>111/111 [==============================] - 1s 6ms/step - loss: 0.5742 - mean_absolute_error: 0.5423
Validation performance: {&#39;loss&#39;: 0.5742337107658386, &#39;mean_absolute_error&#39;: 0.542259156703949}
Test performance: {&#39;loss&#39;: 0.3656980097293854, &#39;mean_absolute_error&#39;: 0.418813019990921}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Lets try bidirectional lstm</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[92]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">bidirectional_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the bidirectional LSTM model</span>
<span class="n">history_bidirectional_lstm</span> <span class="o">=</span> <span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                        <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                                        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>

<span class="c1"># Evaluate the bidirectional LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Bidirectional_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_bidirectional_lstm</span><span class="p">)</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bidirectional_lstm_model</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 29s 19ms/step - loss: 1.4181 - mean_absolute_error: 0.6367 - val_loss: 1.0087 - val_mean_absolute_error: 0.5750 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.7815 - mean_absolute_error: 0.4996 - val_loss: 0.8007 - val_mean_absolute_error: 0.5412 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.6462 - mean_absolute_error: 0.4699 - val_loss: 0.6648 - val_mean_absolute_error: 0.5021 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.5725 - mean_absolute_error: 0.4537 - val_loss: 0.5917 - val_mean_absolute_error: 0.4802 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.5181 - mean_absolute_error: 0.4408 - val_loss: 0.5018 - val_mean_absolute_error: 0.4434 - lr: 1.0000e-04
Epoch 6/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.4767 - mean_absolute_error: 0.4291 - val_loss: 0.4419 - val_mean_absolute_error: 0.4208 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.4406 - mean_absolute_error: 0.4181 - val_loss: 0.4026 - val_mean_absolute_error: 0.4001 - lr: 1.0000e-04
Epoch 8/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.4140 - mean_absolute_error: 0.4089 - val_loss: 0.3815 - val_mean_absolute_error: 0.3993 - lr: 1.0000e-04
Epoch 9/20
1001/1001 [==============================] - 18s 18ms/step - loss: 0.3885 - mean_absolute_error: 0.3972 - val_loss: 0.3780 - val_mean_absolute_error: 0.4024 - lr: 1.0000e-04
Epoch 10/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3653 - mean_absolute_error: 0.3874 - val_loss: 0.3541 - val_mean_absolute_error: 0.3853 - lr: 1.0000e-04
Epoch 11/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.3477 - mean_absolute_error: 0.3780 - val_loss: 0.3289 - val_mean_absolute_error: 0.3685 - lr: 1.0000e-04
Epoch 12/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3342 - mean_absolute_error: 0.3729 - val_loss: 0.3133 - val_mean_absolute_error: 0.3597 - lr: 1.0000e-04
Epoch 13/20
1001/1001 [==============================] - 17s 17ms/step - loss: 0.3241 - mean_absolute_error: 0.3663 - val_loss: 0.2906 - val_mean_absolute_error: 0.3368 - lr: 1.0000e-04
Epoch 14/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.3119 - mean_absolute_error: 0.3585 - val_loss: 0.2927 - val_mean_absolute_error: 0.3413 - lr: 1.0000e-04
Epoch 15/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.3037 - mean_absolute_error: 0.3544 - val_loss: 0.2564 - val_mean_absolute_error: 0.3109 - lr: 1.0000e-04
Epoch 16/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.2938 - mean_absolute_error: 0.3471 - val_loss: 0.2451 - val_mean_absolute_error: 0.3051 - lr: 1.0000e-04
Epoch 17/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.2871 - mean_absolute_error: 0.3428 - val_loss: 0.2404 - val_mean_absolute_error: 0.2970 - lr: 1.0000e-04
Epoch 18/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.2859 - mean_absolute_error: 0.3433 - val_loss: 0.2345 - val_mean_absolute_error: 0.2922 - lr: 1.0000e-04
Epoch 19/20
1001/1001 [==============================] - 16s 16ms/step - loss: 0.2792 - mean_absolute_error: 0.3390 - val_loss: 0.2331 - val_mean_absolute_error: 0.2922 - lr: 1.0000e-04
Epoch 20/20
1001/1001 [==============================] - 18s 18ms/step - loss: 0.2725 - mean_absolute_error: 0.3352 - val_loss: 0.2097 - val_mean_absolute_error: 0.2730 - lr: 1.0000e-04
111/111 [==============================] - 1s 8ms/step - loss: 0.2097 - mean_absolute_error: 0.2730
Validation performance: {&#39;loss&#39;: 0.2097020447254181, &#39;mean_absolute_error&#39;: 0.27295613288879395}
Test performance: {&#39;loss&#39;: 0.1465262919664383, &#39;mean_absolute_error&#39;: 0.21986787021160126}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2><strong>THE ABSOLUTE BEST MODEL SO FAR^^^</strong><a rel="noopener" class="anchor-link" href="#THE-ABSOLUTE-BEST-MODEL-SO-FAR%5E%5E%5E">&#182;</a></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Significant change and lots of improvement, but I  lets try CNNs with LSTM</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[93]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">conv_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling1D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling1D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">)),</span>  <span class="c1"># Reshape to match LSTM input</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">conv_lstm_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                        <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                        <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the 1D Convnet + LSTM model</span>
<span class="n">history_conv_lstm</span> <span class="o">=</span> <span class="n">conv_lstm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                        <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>

<span class="c1"># Evaluate the 1D Convnet + LSTM model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Conv_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Conv_LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Conv_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Conv_LSTM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_conv_lstm</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 17s 11ms/step - loss: 1.1273 - mean_absolute_error: 0.8730 - val_loss: 0.9966 - val_mean_absolute_error: 0.8326 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.8339 - mean_absolute_error: 0.7228 - val_loss: 0.6997 - val_mean_absolute_error: 0.6635 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5803 - mean_absolute_error: 0.5635 - val_loss: 0.4575 - val_mean_absolute_error: 0.5007 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.5255 - mean_absolute_error: 0.5338 - val_loss: 0.4230 - val_mean_absolute_error: 0.4747 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 11s 10ms/step - loss: 0.4949 - mean_absolute_error: 0.5184 - val_loss: 0.4181 - val_mean_absolute_error: 0.4747 - lr: 1.0000e-04
Epoch 6/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4769 - mean_absolute_error: 0.5097 - val_loss: 0.3993 - val_mean_absolute_error: 0.4608 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4618 - mean_absolute_error: 0.5016 - val_loss: 0.3890 - val_mean_absolute_error: 0.4522 - lr: 1.0000e-04
Epoch 8/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4505 - mean_absolute_error: 0.4954 - val_loss: 0.3854 - val_mean_absolute_error: 0.4512 - lr: 1.0000e-04
Epoch 9/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4386 - mean_absolute_error: 0.4870 - val_loss: 0.3668 - val_mean_absolute_error: 0.4362 - lr: 1.0000e-04
Epoch 10/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4306 - mean_absolute_error: 0.4820 - val_loss: 0.3785 - val_mean_absolute_error: 0.4482 - lr: 1.0000e-04
Epoch 11/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4229 - mean_absolute_error: 0.4778 - val_loss: 0.3651 - val_mean_absolute_error: 0.4386 - lr: 1.0000e-04
Epoch 12/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4174 - mean_absolute_error: 0.4743 - val_loss: 0.3600 - val_mean_absolute_error: 0.4333 - lr: 1.0000e-04
Epoch 13/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4106 - mean_absolute_error: 0.4696 - val_loss: 0.3500 - val_mean_absolute_error: 0.4271 - lr: 1.0000e-04
Epoch 14/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4064 - mean_absolute_error: 0.4667 - val_loss: 0.3364 - val_mean_absolute_error: 0.4165 - lr: 1.0000e-04
Epoch 15/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4008 - mean_absolute_error: 0.4627 - val_loss: 0.3442 - val_mean_absolute_error: 0.4240 - lr: 1.0000e-04
Epoch 16/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.3988 - mean_absolute_error: 0.4606 - val_loss: 0.3495 - val_mean_absolute_error: 0.4277 - lr: 1.0000e-04
Epoch 17/20
 997/1001 [============================&gt;.] - ETA: 0s - loss: 0.3993 - mean_absolute_error: 0.4619
Epoch 17: ReduceLROnPlateau reducing learning rate to 4.999999873689376e-05.
1001/1001 [==============================] - 10s 10ms/step - loss: 0.3989 - mean_absolute_error: 0.4616 - val_loss: 0.3386 - val_mean_absolute_error: 0.4210 - lr: 1.0000e-04
Epoch 18/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.3906 - mean_absolute_error: 0.4517 - val_loss: 0.3384 - val_mean_absolute_error: 0.4242 - lr: 5.0000e-05
Epoch 19/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.3871 - mean_absolute_error: 0.4488 - val_loss: 0.3420 - val_mean_absolute_error: 0.4279 - lr: 5.0000e-05
Epoch 20/20
1001/1001 [==============================] - ETA: 0s - loss: 0.3855 - mean_absolute_error: 0.4466
Epoch 20: ReduceLROnPlateau reducing learning rate to 2.499999936844688e-05.
1001/1001 [==============================] - 9s 9ms/step - loss: 0.3855 - mean_absolute_error: 0.4466 - val_loss: 0.3400 - val_mean_absolute_error: 0.4239 - lr: 5.0000e-05
111/111 [==============================] - 1s 8ms/step - loss: 0.3400 - mean_absolute_error: 0.4239
Validation performance: {&#39;loss&#39;: 0.33998599648475647, &#39;mean_absolute_error&#39;: 0.4238726496696472}
Test performance: {&#39;loss&#39;: 0.2500213384628296, &#39;mean_absolute_error&#39;: 0.3495366871356964}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[94]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">conv_lstm_model</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>improvement from lstm rnn, but not from the birenctional RNNs</strong></p>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Lets try 1D convolutional neural network (ConvNet) combined with Gated Recurrent Units (GRUs)</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[95]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Define the 1D ConvNet + GRU model</span>
<span class="n">conv_gru_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># 1D Convolutional layers for feature extraction</span>
    <span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
    <span class="n">MaxPooling1D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">MaxPooling1D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">Flatten</span><span class="p">(),</span>
    <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">Reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">)),</span>  <span class="c1"># Adjust the shape to fit into GRU layer</span>
    <span class="c1"># GRU layers for capturing temporal dependencies</span>
    <span class="n">GRU</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
    <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">GRU</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
    <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Compile the model</span>
<span class="n">conv_gru_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                       <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
                       <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="c1"># Training the 1D ConvNet + GRU model</span>
<span class="n">history_conv_gru</span> <span class="o">=</span> <span class="n">conv_gru_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                      <span class="n">validation_data</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                                      <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">])</span>

<span class="c1"># Evaluate the 1D ConvNet + GRU model</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Conv_GRU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_gru_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Conv_GRU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_gru_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation performance: </span><span class="si">{</span><span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Conv_GRU&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test performance: </span><span class="si">{</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Conv_GRU&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">w1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">conv_gru_model</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Epoch 1/20
1001/1001 [==============================] - 16s 11ms/step - loss: 1.2057 - mean_absolute_error: 0.8828 - val_loss: 0.9823 - val_mean_absolute_error: 0.7929 - lr: 1.0000e-04
Epoch 2/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.8847 - mean_absolute_error: 0.7182 - val_loss: 0.9763 - val_mean_absolute_error: 0.7695 - lr: 1.0000e-04
Epoch 3/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.6646 - mean_absolute_error: 0.5863 - val_loss: 0.5491 - val_mean_absolute_error: 0.5181 - lr: 1.0000e-04
Epoch 4/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.6071 - mean_absolute_error: 0.5568 - val_loss: 0.5968 - val_mean_absolute_error: 0.5593 - lr: 1.0000e-04
Epoch 5/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5603 - mean_absolute_error: 0.5318 - val_loss: 0.5784 - val_mean_absolute_error: 0.5492 - lr: 1.0000e-04
Epoch 6/20
 999/1001 [============================&gt;.] - ETA: 0s - loss: 0.5292 - mean_absolute_error: 0.5167
Epoch 6: ReduceLROnPlateau reducing learning rate to 4.999999873689376e-05.
1001/1001 [==============================] - 10s 10ms/step - loss: 0.5292 - mean_absolute_error: 0.5167 - val_loss: 0.5900 - val_mean_absolute_error: 0.5594 - lr: 1.0000e-04
Epoch 7/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.5091 - mean_absolute_error: 0.5016 - val_loss: 0.5261 - val_mean_absolute_error: 0.5217 - lr: 5.0000e-05
Epoch 8/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4993 - mean_absolute_error: 0.4973 - val_loss: 0.5106 - val_mean_absolute_error: 0.5137 - lr: 5.0000e-05
Epoch 9/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4902 - mean_absolute_error: 0.4934 - val_loss: 0.4955 - val_mean_absolute_error: 0.5059 - lr: 5.0000e-05
Epoch 10/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4820 - mean_absolute_error: 0.4889 - val_loss: 0.4780 - val_mean_absolute_error: 0.4952 - lr: 5.0000e-05
Epoch 11/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.4747 - mean_absolute_error: 0.4861 - val_loss: 0.4650 - val_mean_absolute_error: 0.4886 - lr: 5.0000e-05
Epoch 12/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4683 - mean_absolute_error: 0.4825 - val_loss: 0.4509 - val_mean_absolute_error: 0.4793 - lr: 5.0000e-05
Epoch 13/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4621 - mean_absolute_error: 0.4795 - val_loss: 0.4502 - val_mean_absolute_error: 0.4810 - lr: 5.0000e-05
Epoch 14/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4551 - mean_absolute_error: 0.4762 - val_loss: 0.4471 - val_mean_absolute_error: 0.4808 - lr: 5.0000e-05
Epoch 15/20
1001/1001 [==============================] - 9s 9ms/step - loss: 0.4501 - mean_absolute_error: 0.4735 - val_loss: 0.4329 - val_mean_absolute_error: 0.4709 - lr: 5.0000e-05
Epoch 16/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4410 - mean_absolute_error: 0.4687 - val_loss: 0.4318 - val_mean_absolute_error: 0.4693 - lr: 5.0000e-05
Epoch 17/20
1001/1001 [==============================] - 11s 11ms/step - loss: 0.4384 - mean_absolute_error: 0.4669 - val_loss: 0.4270 - val_mean_absolute_error: 0.4669 - lr: 5.0000e-05
Epoch 18/20
1001/1001 [==============================] - 11s 10ms/step - loss: 0.4334 - mean_absolute_error: 0.4640 - val_loss: 0.4232 - val_mean_absolute_error: 0.4650 - lr: 5.0000e-05
Epoch 19/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4288 - mean_absolute_error: 0.4618 - val_loss: 0.4149 - val_mean_absolute_error: 0.4592 - lr: 5.0000e-05
Epoch 20/20
1001/1001 [==============================] - 10s 10ms/step - loss: 0.4233 - mean_absolute_error: 0.4585 - val_loss: 0.4048 - val_mean_absolute_error: 0.4504 - lr: 5.0000e-05
111/111 [==============================] - 1s 5ms/step - loss: 0.4048 - mean_absolute_error: 0.4504
Validation performance: {&#39;loss&#39;: 0.4048386216163635, &#39;mean_absolute_error&#39;: 0.45041391253471375}
Test performance: {&#39;loss&#39;: 0.3055536448955536, &#39;mean_absolute_error&#39;: 0.3808938264846802}
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output">
<img src="javascript://"/>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<p><strong>Also better than the latest LSTM RNN, but bidirectional still better</strong></p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[95]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2><strong>Predictions</strong><a rel="noopener" class="anchor-link" href="#Predictions">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[96]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Number of instances in the test set</span>
<span class="n">test_set_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test set length: </span><span class="si">{</span><span class="n">test_set_length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calculate the expected number of windows</span>
<span class="n">total_window_size</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">3</span>
<span class="n">expected_windows</span> <span class="o">=</span> <span class="n">test_set_length</span> <span class="o">-</span> <span class="n">total_window_size</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected number of windows: </span><span class="si">{</span><span class="n">expected_windows</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Number of windows generated</span>
<span class="n">test_windows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of windows generated: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>Test set length: 5000
Expected number of windows: 4986
Number of windows generated: 156
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[97]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Make predictions on the test set</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">bidirectional_lstm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>156/156 [==============================] - 3s 7ms/step
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[98]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Extract the final prediction for each window</span>
<span class="n">final_predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[99]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">unnormalized_predictions</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">final_predictions</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[100]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_id</span> <span class="o">=</span> <span class="mi">35589</span>
<span class="n">num_predictions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unnormalized_predictions</span><span class="p">)</span>
<span class="n">end_id</span> <span class="o">=</span> <span class="n">start_id</span> <span class="o">+</span> <span class="n">num_predictions</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_id</span><span class="p">,</span> <span class="n">end_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[101]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
     <div class="CodeMirror cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create the submission DataFrame</span>
<span class="n">submission_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ids</span><span class="p">,</span>
    <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">unnormalized_predictions</span>
<span class="p">})</span>

<span class="c1"># Save the submission file</span>
<span class="n">submission_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Verify the first few rows of the submission file</span>
<span class="nb">print</span><span class="p">(</span><span class="n">submission_df</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output">
<pre>         id   prediction
0     35589  5241.399902
1     35590  5705.662109
2     35591  5903.540039
3     35592  6130.532715
4     35593  6218.131836
...     ...          ...
4981  40570  3608.328857
4982  40571  3200.034912
4983  40572  2774.746582
4984  40573  2272.412842
4985  40574  1681.840210

[4986 rows x 2 columns]
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">

</div>
</div>
</div>
</div>









<script type="module" src="https://s.brightspace.com/lib/bsi/2024.6.211/unbundled/mathjax.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
					if (document.querySelector('math') || /\$\$|\\\(|\\\[|\\begin{|\\ref{|\\eqref{/.test(document.body.innerHTML)) {
						document.querySelectorAll('mspace[linebreak="newline"]').forEach(elm => {
							elm.setAttribute('style', 'display: block; height: 0.5rem;');
						});

						window.D2L.MathJax.loadMathJax({
							outputScale: 1.5,
							renderLatex: false,
							enableMML3Support: false
						});
					}
				});</script><script type="module" src="https://s.brightspace.com/lib/bsi/2024.6.211/unbundled/prism.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
					document.querySelectorAll('.d2l-code').forEach(code => {
						window.D2L.Prism.formatCodeElement(code);
					});
				});</script><script type="module" src="https://s.brightspace.com/lib/bsi/2024.6.211/unbundled/embeds.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
					window.D2L.EmbedRenderer.renderEmbeds(document.body);
				});</script></body></html>